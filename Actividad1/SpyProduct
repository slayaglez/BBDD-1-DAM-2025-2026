Somos una empresa de desarrollo de software y se nos pide que:
El cliente quiere un software que haga un seguimiento de precios de la competencia, en ese seguimiento debe de aparecer la plataforma que compite contra ellos, así como un historial de cambios de precio y estadísticas relevantes (media, mediana, moda, máximo y mínimo; para cada producto).

De los productos se desea: 
-nombre
-categoría
-precio
-fecha de la observación
-plataforma

=========CREATE TABLES===========

CREATE TABLE IF NOT EXISTS "product" (
	"id_product" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
	"name" VARCHAR(255),
	"category" VARCHAR(255),
	"price" REAL NOT NULL,
	"last_update" TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    "url" VARCHAR(255),
	PRIMARY KEY("id_product")
);


CREATE TABLE IF NOT EXISTS "platform" (
	"id_platform" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
	"name" VARCHAR(255),
	PRIMARY KEY("id_platform")
);


CREATE TABLE IF NOT EXISTS "history" (
	"id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
	"id_product_fk" INTEGER,
	"id_platform_fk" INTEGER,
    "price_stamp" REAL,
	"last_update" TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY("id")
);


ALTER TABLE "history"
ADD FOREIGN KEY("id_product_fk") REFERENCES "product"("id_product")
ON UPDATE NO ACTION ON DELETE NO ACTION;
ALTER TABLE "history"
ADD FOREIGN KEY("id_platform_fk") REFERENCES "platform"("id_platform")
ON UPDATE NO ACTION ON DELETE NO ACTION;

=========INSERT TABLES===============

INSERT INTO platform (name)
VALUES
('Amazon'),
('Shein'),
('Temu'),
('AliExpress'),
('PcComponentes');

INSERT INTO product (name, category, price)
VALUES
('monitor', 'informatica', 99.99),
('ordenador', 'informatica', 399.99),
('camiseta', 'moda', 18.00),
('pantalon', 'moda', 20.00),
('desatascador', 'aseo', 25.50);


INSERT INTO history (id_product_fk, id_platform_fk, price_stamp)
VALUES
(1, 1, 100.99),
(1, 3, 99.99),
(1, 5, 89.99),
(2, 5, 299.99),
(2, 1, 349.99),
(3, 2, 19.00),
(3, 3, 10.00),
(3, 1, 14.00),
(4, 2, 19.00),
(5, 1, 21.00);


========CONSULTAS===========
Buscamos el id del producto:
SELECT id_product, name FROM product WHERE name = 'monitor';
Calcular la media de la columna:
SELECT AVG(price_stamp) FROM history WHERE history.id_product_fk = 1;

Calcular la mediana:
SELECT PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY price_stamp) AS mediana
FROM history;

Calcular la moda:
SELECT price_stamp, COUNT(price_stamp) AS frecuencia
FROM history
GROUP BY price_stamp
ORDER BY frecuencia DESC LIMIT 1;










